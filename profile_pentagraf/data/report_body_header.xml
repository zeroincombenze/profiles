<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_invoice_pentagraf_body_header">
        <t t-name="base_multireport.report_invoice_body_header">
            <t t-set="term_position" t-value="report.get_report_attrib('payment_term_position',o,doc_opts)"/>
            <t t-if="report.get_report_attrib('payment_term_position',o,doc_opts) == 'header' or (report.get_report_attrib('payment_term_position',o,doc_opts) == 'auto' and len(o.due_records) &lt; 2)"
               t-set="term_position" t-value="'header'"/>
            <t t-if="report.get_report_attrib('payment_term_position',o,doc_opts) != 'header' and (report.get_report_attrib('payment_term_position',o,doc_opts) == 'auto' and len(o.due_records) &gt;= 2)"
               t-set="term_position" t-value="'footer'"/>
            <t t-if="not o.payment_term_id" t-set="term_position" t-value="'none'"/>
            <t t-if="not doctype and o.type == 'in_invoice'" t-set="doctype" t-value="'Ft. fornitore'"/>
            <t t-if="not doctype and o.type == 'in_refund'" t-set="doctype" t-value="'NC fornitore'"/>
            <t t-if="not doctype and o.type == 'out_refund'" t-set="doctype" t-value="'Nota credito'"/>
            <t t-if="not doctype" t-set="doctype" t-value="'Fattura'"/>
            <t t-if="o.state == 'proforma2'" t-set="desdoc" t-value="doctype + ' PRO-FORMA'"/>
            <t t-if="o.state == 'draft'" t-set="desdoc" t-value="'bozza ' + doctype"/>
            <t t-if="o.state == 'cancel'" t-set="desdoc" t-value="doctype + ' annullata!'"/>
            <t t-if="not desdoc" t-set="desdoc" t-value="doctype"/>

            <div class="row mt32 mb32">
                <div class="col-xs-2">
                    <u>
                        <span t-esc="desdoc"/>
                    </u>
                    <b>
                        <span t-if="o.state not in ('draft','cancel')" t-field="o.number"/>
                    </b>
                    <b>
                        <span t-if="o.state in ('draft','cancel')" t-field="o.move_name"/>
                    </b>
                </div>
                <div class="col-xs-2" t-if="o.date_invoice">
                    <u>Data fattura:</u>
                    <b>
                        <span t-field="o.date_invoice"/>
                    </b>
                </div>
                <div class="col-xs-2"
                     t-if="term_position == 'odoo' and o.date_due and o.type == 'out_invoice' and o.state in ('open', 'paid')">
                    <strong>Data scadenza:</strong>
                    <p t-field="o.date_due"/>
                </div>
                <div class="col-xs-2" t-if="term_position in ('header', 'header_no_iban')">
                    <strong>Data scadenza:</strong>
                    <p t-if="len(o.due_records) &lt; 2" t-field="o.date_due"/>
                    <p t-if="len(o.due_records) &gt;= 2">
                        <t t-foreach="o.due_records.sorted(key=lambda r: r.date_maturity)" t-as="p">
                            <span t-field="p.date_maturity"/>
                        </t>
                    </p>
                </div>
                <div class="col-xs-2" t-if="o.partner_id.ref">
                    <strong>Codice cliente:</strong>
                    <p t-field="o.partner_id.ref"/>
                </div>
                <div name="reference" class="col-xs-2" t-if="o.reference">
                    <strong>Riferimento:</strong>
                    <p t-field="o.reference"/>
                </div>
                <div class="col-xs-4" t-if="term_position == 'odoo'">
                    <strong>Termini di pagamento:</strong>
                    <p t-field="o.payment_term_id"/>
                </div>
                <div class="col-xs-4" t-if="term_position in ('header', 'header_no_iban')">
                    <strong>Termini di pagamento:</strong>
                    <p t-if="o.payment_term_id.note" t-field="o.payment_term_id.note"/>
                    <p t-if="not o.payment_term_id.note" t-field="o.payment_term_id"/>
                </div>
                <div class="col-xs-4" t-if="term_position in ('header', 'odoo') and o.partner_bank_id">
                    <strong>IBAN:</strong>
                    <p t-field="o.partner_bank_id.display_name"/>
                </div>
                <div class="col-xs-4"
                     t-if="term_position in ('header', 'odoo') and not o.partner_bank_id and o.partner_id.bank_ids and o.payment_term_id and (o.payment_term_id.riba or o.payment_term_id.fatturapa_pm_id.code in ('MP11', 'MP12', 'MP16', 'MP17', 'MP19', 'MP20', 'MP21'))">
                    <strong>IBAN:</strong>
                    <p>
                        <t t-foreach="o.partner_id.bank_ids" t-as="bank">
                            <span t-field="bank.display_name"/>
                        </t>
                    </p>
                </div>
                <div class="col-xs-4"
                     t-if="term_position in ('header', 'odoo') and not o.partner_bank_id and o.company_id.partner_id.bank_ids and o.payment_term_id and o.payment_term_id.fatturapa_pm_id.code in ('MP05', 'MP07', 'MP08', 'MP13', 'MP18')">
                    <strong>IBAN:</strong>
                    <p>
                        <t t-foreach="o.company_id.partner_id.bank_ids" t-as="bank">
                            <span t-if="bank.journal_id and bank.journal_id.display_on_footer"
                                  t-field="bank.display_name"/>
                        </t>
                    </p>
                </div>
            </div>
        </t>
    </template>

</odoo>

